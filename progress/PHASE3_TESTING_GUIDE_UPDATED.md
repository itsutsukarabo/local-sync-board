# Phase 3: ゲーム画面レイアウト - 動作確認手順（更新版）

## 🎯 確認する機能

Phase 3 で実装したゲーム画面のレイアウトとコンポーネント、およびホストの参加/退出機能が正しく動作することを確認します。

## 📋 事前準備

### 1. 開発サーバーの起動

```bash
cd app
npm start
```

または

```bash
cd app
npx expo start
```

### 2. Supabase の確認

- Supabase プロジェクトが起動していることを確認
- `.env`ファイルに正しい接続情報が設定されていることを確認

## ✅ 動作確認手順

### テスト 1: 空のルーム状態の確認（ホスト未参加）

**目的**: ホストが参加していない状態で適切な空状態が表示されることを確認

1. アプリを起動
2. 「部屋を作る」をタップ
3. ルームが作成され、ゲーム画面に遷移することを確認

**期待される結果:**

- ✅ ヘッダーにルームコードが表示される
- ✅ 「0 人参加中」と表示される
- ✅ ステータスバッジに「募集中」と表示される
- ✅ **「🎮 ゲームに参加」ボタンが表示される（緑色）**
- ✅ プレイヤーセクションに空状態が表示される
  - 👥 アイコン
  - 「まだプレイヤーがいません」というメッセージ
  - 「ルームコードを共有して参加を待ちましょう」というサブテキスト
- ✅ ホストコントロールセクションが表示される
- ✅ 「ゲーム開始」ボタンが表示される

### テスト 2: ホストのゲーム参加

**目的**: ホストがゲームに参加できることを確認

1. 「🎮 ゲームに参加」ボタンをタップ

**期待される結果:**

- ✅ 「1 人参加中」に更新される
- ✅ ボタンが「🚪 ゲームから退出」に変わる（オレンジ色）
- ✅ 自分の PlayerCard が表示される
  - 「あなた 👑」と表示される（ホストなので王冠付き）
  - スコア（点数: 25000）が表示される
- ✅ カードに適切なシャドウとボーダーが表示される

### テスト 3: ホストのゲーム退出

**目的**: ホストがゲームから退出できることを確認

1. 「🚪 ゲームから退出」ボタンをタップ
2. 確認ダイアログで「退出」をタップ

**期待される結果:**

- ✅ 確認ダイアログが表示される
  - タイトル: 「確認」
  - メッセージ: 「ゲームから退出しますか？（ルームには残ります）」
  - ボタン: 「キャンセル」と「退出」
- ✅ 「0 人参加中」に戻る
- ✅ ボタンが「🎮 ゲームに参加」に戻る
- ✅ 空状態が再度表示される
- ✅ ホストコントロールは引き続き表示される（ルームから退出していないため）

### テスト 4: 他のプレイヤーの参加

**目的**: 他のプレイヤーが参加した際に PlayerCard が正しく表示されることを確認

1. 別のデバイスまたはブラウザで同じアプリを開く
2. 「部屋に入る」をタップ
3. ルームコードを入力して参加

**期待される結果:**

- ✅ 両方のデバイスでプレイヤー数が更新される（「1 人参加中」）
- ✅ ホストのデバイスで他のプレイヤーの PlayerCard が表示される
- ✅ 参加したプレイヤーのデバイスで自分のカードが「あなた」と表示される
- ✅ 各プレイヤーのスコア（点数: 25000）が表示される

### テスト 5: ホストが参加してからゲーム開始

**目的**: ホストが参加した状態でゲームを開始できることを確認

1. ホストのデバイスで「🎮 ゲームに参加」をタップ（まだ参加していない場合）
2. 「ゲーム開始」ボタンをタップ
3. 確認ダイアログで「開始」をタップ

**期待される結果:**

- ✅ ステータスバッジが「プレイ中」に変わる
- ✅ 背景色が緑系（#dcfce7）に変わる
- ✅ 参加しているプレイヤーに「アクション」セクションが表示される
- ✅ アクションボタンが表示される
  - 「リーチ」ボタン
  - 「ツモ」ボタン
  - 「ロン」ボタン
- ✅ ボタンが青色（#3b82f6）で表示される
- ✅ ボタンにシャドウエフェクトがある

### テスト 6: 参加していないユーザーの表示

**目的**: ゲームに参加していないユーザーにはアクションボタンが表示されないことを確認

1. ホストがゲームから退出した状態でゲームを開始
2. または、新しいユーザーがゲーム開始後にルームに入室

**期待される結果:**

- ✅ 「🎮 ゲームに参加」ボタンが表示される
- ✅ アクションボタンは表示されない
- ✅ 他のプレイヤーのカードは表示される
- ✅ ホストコントロールは表示される（ホストの場合）

### テスト 7: アクションボタンのタップ確認

**目的**: アクションボタンをタップした際に適切なダイアログが表示されることを確認

1. ゲームに参加した状態で任意のアクションボタン（例: 「リーチ」）をタップ

**期待される結果:**

- ✅ アラートダイアログが表示される
- ✅ タイトルに「アクション実行」と表示される
- ✅ メッセージに「リーチ を実行します」と表示される
- ✅ 計算式が表示される（例: 「計算式: score - 1000」）
- ✅ 「キャンセル」と「実行」ボタンが表示される
- ✅ タップ時に視覚的なフィードバック（透明度変化）がある

### テスト 8: ホストコントロールの確認

**目的**: ホスト専用のコントロールが正しく機能することを確認

1. ホストのデバイスで下にスクロール
2. 「ホストコントロール」セクションを確認

**期待される結果:**

- ✅ 「ホストコントロール」セクションが表示される（ホストのみ）
- ✅ プレイ中は「ゲーム終了」ボタンが表示される
- ✅ ボタンが赤色（#ef4444）で表示される
- ✅ 「ゲーム終了」をタップすると確認ダイアログが表示される

### テスト 9: 非ホストユーザーの表示確認

**目的**: 非ホストユーザーには適切な権限制限が適用されることを確認

1. 非ホストのデバイスでゲーム画面を確認

**期待される結果:**

- ✅ ヘッダーに設定ボタン（⚙️）が表示されない
- ✅ 「ホストコントロール」セクションが表示されない
- ✅ 「🎮 ゲームに参加」または「🚪 ゲームから退出」ボタンが表示される
- ✅ プレイヤーカードは正常に表示される
- ✅ アクションボタンは表示される（参加している場合）

### テスト 10: リアルタイム同期の確認

**目的**: 複数デバイス間でリアルタイムに同期されることを確認

1. ホストのデバイスでゲームに参加
2. 非ホストのデバイスで画面を確認

**期待される結果:**

- ✅ 両方のデバイスでプレイヤー数が更新される
- ✅ ホストが参加/退出すると、両方のデバイスで即座に反映される
- ✅ ゲームステータスの変更がリアルタイムに反映される
- ✅ プレイヤーの追加/削除がリアルタイムに反映される

## 🎨 ビジュアル確認ポイント

### ボタンのカラースキーム

- [ ] 参加ボタン: 緑色（#10b981）
- [ ] 退出ボタン: オレンジ色（#f59e0b）
- [ ] アクションボタン: 青色（#3b82f6）
- [ ] ゲーム開始ボタン: 緑色（#10b981）
- [ ] ゲーム終了ボタン: 赤色（#ef4444）

### タイポグラフィ

- [ ] ルームコード: 18px, bold
- [ ] プレイヤー名: 16px, semi-bold
- [ ] スコア値: 24px, bold
- [ ] ボタンテキスト: 16px, semi-bold

### エフェクト

- [ ] ボタンにシャドウエフェクト
- [ ] カードにシャドウエフェクト
- [ ] タップ時の透明度変化

## 🐛 よくある問題と解決方法

### 問題 1: 参加ボタンが表示されない

**原因**: ユーザー認証が正しく行われていない可能性

**解決方法**:

- アプリを再起動
- 認証状態を確認

### 問題 2: 参加/退出が反映されない

**原因**: Supabase Realtime が有効になっていない可能性

**解決方法**:

- Supabase ダッシュボードで realtime が有効か確認
- ネットワーク接続を確認

### 問題 3: ホストが退出できない

**原因**: データベースの権限設定の問題

**解決方法**:

- RLS ポリシーを確認
- ホストの user_id が正しいか確認

## 📊 チェックリスト

実装完了の確認:

- [ ] ホストが参加せずにルームを作成できる
- [ ] 「🎮 ゲームに参加」ボタンが表示される
- [ ] ホストがゲームに参加できる
- [ ] 参加後、「🚪 ゲームから退出」ボタンに変わる
- [ ] ホストがゲームから退出できる
- [ ] 退出後、「🎮 ゲームに参加」ボタンに戻る
- [ ] 参加していないユーザーにアクションボタンが表示されない
- [ ] 参加しているユーザーにアクションボタンが表示される
- [ ] PlayerCard コンポーネントが正しく表示される
- [ ] リアルタイム同期が動作する
- [ ] ホストコントロールが正しく機能する

## 🎉 完了条件

すべてのテストケースが ✅ になり、チェックリストがすべて完了したら、Phase 3 のタスク 1「ゲーム画面のレイアウト作成」および参加/退出機能の実装は完了です！

## 📝 次のステップ

Phase 3 の残りのタスク:

- タスク 2: プレイヤー一覧の表示（完了）
- タスク 3: スコア表示コンポーネント（完了）
- タスク 4: スコア操作ボタン（完了）
- タスク 5: Realtime サブスクリプションの実装
- タスク 6: 楽観的 UI 更新

---

**注意**: この確認手順は、実装したコンポーネントと参加/退出機能の基本的な動作を確認するためのものです。
