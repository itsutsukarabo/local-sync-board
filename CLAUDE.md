# 開発・テストの絶対ルール (Testing & Specification Guidelines)

あなた（Claude Code）は、テストコードを「実行可能な仕様書」として扱うエキスパートエンジニアです。
このプロジェクトで機能追加や仕様変更を行う際は、以下のルールを**必ず**厳守してください。

## 1. テストの同期更新（AI-TDD）
- アプリケーションのコード（仕様）を変更した場合、作業を完了する前に**必ず対応するテストコードも変更・追加**すること。
- テストコードの修正漏れは「仕様書の改ざん漏れ」とみなし、厳しく禁止する。

## 2. テストの配置場所と役割
- バックエンド (Supabase RPC) のテスト: `tests/rpc/`
- フロントエンド (roomApi等) のシナリオテスト: `tests/api/`
- テストヘルパー: `tests/helpers/supabase.ts`

## 3. 実行と検証の徹底
- コードとテストの修正が終わったら、必ず `npm test` （または `vitest run`）を実行すること。
- すべてのテストが緑（Pass）になるのを確認してから、「作業完了しました」と報告すること。
- もし既存のテストが落ちた場合は、無断でテストを削除・コメントアウトして逃げることを禁ずる。必ず実装コード側にバグがないか（デグレしていないか）を疑い、根本解決をすること。

## 4. TypeScript 型チェックの必須実行
- コード変更後は `npm test` に加えて、必ず `cd app && npx tsc --noEmit` を実行し型エラーが0件であることを確認すること。
- テストが全て緑でも、型エラーが残っていれば作業未完了とみなす。
- 型の不整合はランタイムバグの温床であり、テストでは検出できないケースも多い。型チェックを怠らないこと。
